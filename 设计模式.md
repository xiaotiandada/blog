title: è®¾è®¡æ¨¡å¼
categories: è®¾è®¡æ¨¡å¼
tags: []
author: å°ç”°
date: 2020-02-26 23:57:00

---

ç¬¬ä¸€æ¬¡å­¦ä¹ è®¾è®¡æ¨¡å¼ [repo æ‰€æœ‰çš„ä»£ç éƒ½åœ¨è¿™å„¿å•¦!](https://github.com/xiaotiandada/javaScript-design-patterns)

<!-- more --> 

## å·¥å‚æ¨¡å¼

**ç›¸å…³èµ„æ–™:**

[JavaScriptè®¾è®¡æ¨¡å¼æ€»ç»“](https://juejin.im/post/5c984610e51d45656702a785)

[jsè®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼](https://fanerge.github.io/2017/jsè®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼.html)

**åˆ›å»ºä¸‰ä¸ªè§’è‰²ç„¶åéšæœºå†³æ–—âš”ï¸**

```js
console.log('å·¥å‚æ¨¡å¼');

// æ”»å‡»åŠ›1-100
const attackPower = () => Math.floor(Math.random() * 100 + 1)

// æˆ˜å£«
class Warrior {
  constructor() {
    this.occupation = 'æˆ˜å£«'
    this.skill = 'å•ä¸€ç‹‚ç '
    this.blood = 100
    this.hit = attackPower()
    // other
  }
}

// æ³•å¸ˆ
class Mage {
  constructor() {
    this.occupation = 'æ³•å¸ˆ'
    this.skill = 'é›†ä½“å†°å†»'
    this.blood = 100
    this.hit = attackPower()
  }
}

// å°„æ‰‹
class Archer {
  constructor() {
    this.occupation = 'å°„æ‰‹'
    this.skill = 'å…¨å±€è½°ç‚¸'
    this.blood = 100
    this.hit = attackPower()
  }
}

// å·¥å‚å¯¹è±¡
// classã€functionã€object
class RoleFactory {
  constructor() {}
  createRole(role) {
    let roles = {
      Warrior: Warrior,
      Mage: Mage,
      Archer: Archer
    }

    const Character = roles[role]
    return role ? new Character() : new Warrior()

  }
}

// åˆ›å»ºè§’è‰²
let roleFactory = new RoleFactory
let warrior = roleFactory.createRole('Warrior')
let mage = roleFactory.createRole('Mage')
let archer = roleFactory.createRole('Archer')

console.log('warrior:', warrior);
console.log('mage:', mage);
console.log('archer:', archer);

console.log('----------')

// éšæœºè§’è‰²
const randomRole = (data, number) => {
  if (!data || !data.length || !number) return

  let randomRole = []

  for (let i = 0; i < data.length; i++) {
    let sub = Math.floor(Math.random() * data.length )
    randomRole.push(...data.splice(sub, 1))
  }
  return randomRole
}

// æˆ˜æ–—
const duel = roles => {
  // æœ€å¼ºè§’è‰²
  let maxRole = null
  // æœ€é«˜æ”»å‡»åŠ›
  let maxHit = -1
  roles.map(item => {
    console.log(item)
    // å¦‚æœæ”»å‡»åŠ›å¤§äºæœ€å¤§æ”»å‡»åŠ›
    if (item.hit > maxHit) {
      // è®¾ç½®å½“å‰è§’è‰²
      maxRole = item
      // æ”»å‡»åŠ›ä¹Ÿæ›¿æ¢
      maxHit = item.hit
    } else if (item.hit === maxHit) {
      // æ¸…ç©º
      maxRole = null
      maxHit = -1
    }

  })

  return maxRole
}

const compose = (...fn) => fn.reduce((a, b) => (...args) => a(b(...args)))

let winner = compose(duel, randomRole)([warrior, mage, archer], 2)

if (winner) {
  console.log(`èƒœåˆ©è€…æ˜¯: ${winner.occupation}, ä»–çš„æŠ€èƒ½æ˜¯: ${winner.skill}, æ”»å‡»åŠ›: ${winner.hit}`)
} else {
  console.log(`è¿™æ˜¯å¹³å±€`)
}
```

**è¾“å‡º**

```js
å·¥å‚æ¨¡å¼
warrior: Warrior { occupation: 'æˆ˜å£«', skill: 'å•ä¸€ç‹‚ç ', blood: 100, hit: 1 }
mage: Mage { occupation: 'æ³•å¸ˆ', skill: 'é›†ä½“å†°å†»', blood: 100, hit: 39 }
archer: Archer { occupation: 'å°„æ‰‹', skill: 'å…¨å±€è½°ç‚¸', blood: 100, hit: 33 }
----------
Warrior { occupation: 'æˆ˜å£«', skill: 'å•ä¸€ç‹‚ç ', blood: 100, hit: 1 }
Mage { occupation: 'æ³•å¸ˆ', skill: 'é›†ä½“å†°å†»', blood: 100, hit: 39 }
èƒœåˆ©è€…æ˜¯: æ³•å¸ˆ, ä»–çš„æŠ€èƒ½æ˜¯: é›†ä½“å†°å†», æ”»å‡»åŠ›: 39
```



å› ä¸º**ç¬¬ä¸€æ¬¡**å­¦ä¹  è¿˜ä¸å¤ªçŸ¥é“å…·ä½“çš„**ä¼˜ç‚¹å’Œå¥½å¤„** ä¹Ÿæ²¡åŠæ³•**å£å–·** æ‰€ä»¥æš‚æ—¶ç•™ä¸ªå‘ç»™è‡ªå·± ä¸‹æ¬¡æ›´åŠ äº†è§£ä¹‹åå›æ¥**å¡«å‘** ğŸ‘

## å•ä¾‹æ¨¡å¼

https://juejin.im/post/5c984610e51d45656702a785

[https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.html](https://fanerge.github.io/2017/jsè®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼.html)

> å®šä¹‰ï¼šå•ä¾‹å°±æ˜¯ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå®ç°çš„æ–¹æ³•ä¸€èˆ¬æ˜¯å…ˆåˆ¤æ–­å®ä¾‹å­˜åœ¨ä¸å¦ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºäº†å†è¿”å›ï¼Œè¿™å°±ç¡®ä¿äº†ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚ -- å¤åˆ¶çš„

æˆ‘çš„ç†è§£ä¸ºä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹, å¹¶ä¸”å…¨å±€è®¿é—®éƒ½æ˜¯ç›¸åŒçš„å®ä¾‹

å»ºè®®å…ˆçœ‹å®Œä¸Šé¢æ–‡ç« çš„å•ä¾‹æ¨¡å—, æˆ‘è§‰å¾—ä»–ä»¬æ€»ç»“å¾—æ¯”æˆ‘è¦å¥½

```javascript
// ç™»å½•æ¡†
/**
* æˆ‘è¿™é‡Œå•å‡»æŒ‰é’®ğŸ”˜æ˜¾ç¤ºç™»å½•æ¡†, å¹¶ä¸”è‡ªèº«è®¾ç½®å…³é—­äº‹ä»¶ åªæ˜¯éšè—
* åœ¨ä¸‹ä¸€æ¬¡æ˜¾ç¤ºç™»å½•æ¡†çš„æ—¶å€™ä¸ä¼šåˆ›å»º è€Œæ˜¯ç›´æ¥å±•ç¤º å› ä¸ºå•ä¾‹æ¨¡å¼
* ç™»å½•æ¡†å·²ç»åˆ›å»ºäº† æ‰€ä»¥ç›´æ¥è¿”å›äº†å¯¹è±¡ ç„¶åå±•ç¤º
*/
const loginBox = (function(){
  let div
  return function() {
    if (!div) {
      div = document.createElement('div')
      div.onclick = function() {
        div.style.display = 'none'
      }
      div.innerHTML = 'ç™»å½• hhhh (å•å‡»æˆ‘éšè—)'
      document.body.appendChild(div)
    }
    return div
  }
})()

document.querySelector('#btn').onclick = function() {
  let loginbox = loginBox()
  loginbox.style.display = 'block'
}
```

è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºèŒƒ... ğŸ‘

## è£…é¥°å™¨æ¨¡å¼

https://juejin.im/post/5c984610e51d45656702a785

> åœ¨ä¸æ”¹å˜å¯¹è±¡è‡ªèº«çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€çš„ç»™æŸä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶æ¥å£

https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F.html

> å®šä¹‰ï¼šè£…é¥°è€…(decorator)æ¨¡å¼èƒ½å¤Ÿåœ¨ä¸æ”¹å˜å¯¹è±¡è‡ªèº«çš„åŸºç¡€ä¸Šï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç»™å¯¹è±¡åŠ¨æ€çš„æ·»åŠ èŒè´£ã€‚
>
> è¿™æ ·ç»™å¯¹è±¡åŠ¨æ€çš„å¢åŠ èŒè´£çš„æ–¹å¼å°±æ²¡æœ‰æ”¹å˜å¯¹è±¡è‡ªèº«ï¼Œä¸€ä¸ªå¯¹è±¡æ”¾å…¥å¦ä¸€ä¸ªå¯¹è±¡å°±å½¢æˆäº†ä¸€æ¡è£…é¥°é“¾ï¼ˆä¸€ä¸ªèšåˆå¯¹è±¡ï¼‰ï¼Œ è€Œä¸Šé¢çš„shotå’Œtrackä¹Ÿå°±æ˜¯è£…é¥°è€…ã€è£…é¥°å‡½æ•° ï¼Œå½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šæŠŠè¯·æ±‚è½¬ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡ã€‚



```javascript
{
  class Plane {
    fire() {
      console.log('å‘å°„æ™®é€šå­å¼¹')
    }
  }

  class Missile {
    plane: any
    constructor(plane) {
      this.plane = plane
    }

    fire () {
      this.plane.fire()
      console.log('å‘å°„å¯¼å¼¹')
    }
  }

  let plane = new Plane()
  plane = new Missile(plane)
  console.log(plane.fire())
}
```

```javascript
// åˆ©ç”¨AOPç»™å‡½æ•°åŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼Œå³Functionçš„afteræˆ–è€…before
{
  let func = function() {
    console.log('2')
  }

  Function.prototype.before = function(fn) {
    const _this = this
    return function() {
      fn.apply(this, arguments)
      return _this.apply(this, arguments)
    }
  }
  Function.prototype.after = function(fn) {
    const _this = this
    return function() {
      const ret = _this.apply(this, arguments)
      fn.apply(this, arguments)
      return ret
    }
  }
  
  func = func.before(function() {
    console.log(1)
  }).after(() => {
    console.log(3)
  });
  
  func()
}
```

```javascript

{
  // åˆ©ç”¨è£…é¥°å™¨
  function func1() {
    console.log(1)
  }
  function func2() {
    console.log(2)
  }
  class Func {
    @func2
    @func1
    init() {
      console.log(3)
    }
  }

  let func = new Func()
  func.init()

}
```

```javascript
{
  // å°è£…æˆå‡½æ•°
  const before = function (fn, before) {
    return function() {
      before.apply(this, arguments)
      return fn.apply(this, arguments)
    }
  }

  const after = function(fn, after) {
    return function() {
      const ret = fn.apply(this, arguments)
      after.apply(this, arguments)
      return ret
    }
  }

  function func(x) {
    console.log(x)
  }

  function func1(2) {
    console.log(1)
  }


  function func2() {
    console.log(2)
  }


  before(func1, func2)()
  after(func1, func2)()
}
```

æ ¸å¿ƒå°±åœ¨``after`` ``before`` äº†

 ```javascript
{
  // ...
  function handwashing() {
    console.log('æ´—æ‰‹')
  }

  function drink() {
    console.log('å–æ°´')
  }

  function eat() {
    console.log('åƒé¥­')
  }


  before(eat, handwashing)()
  after(eat, drink)()
  
  // åƒé¥­å‰æ´—æ‰‹
  // åƒé¥­åå–æ°´
}
 ```

æ¯”è¾ƒåŸºç¡€çš„æ¼”ç¤ºäº† :)

## ä»£ç†æ¨¡å¼

> ä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç”¨å“æˆ–å ä½ç¬¦ï¼Œä»¥ä¾¿æ§åˆ¶å¯¹å®ƒçš„è®¿é—®ã€‚

[https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F.html](https://fanerge.github.io/2017/jsè®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼.html)

```javascript
// ç¼“å­˜ä»£ç†
const mult = function() {
  let a = 1

  for (let i = 0; i < arguments.length; i++) {
    a *= arguments[i]
  }

  return a
}


const plus = function() {
  let a = 0

  for (let i = 0; i < arguments.length; i++) {
    a += arguments[i]
  }

  return a
}


const createProxyFactory = function(fn) {
  let cache = {} // ä¿å­˜è®¡ç®—ç»“æœ
  return function() {
    let args = Array.from(arguments).join(',')
    if (args in cache) {
      return cache[args]
    } else {
      return cache[args] = fn.apply(this, arguments)
    }
  }
}


let proxyMult = createProxyFactory(mult)
let proxyPlus = createProxyFactory(plus)

console.log(proxyMult(1,2,3,4))
console.log(proxyPlus(1,2,3,4))
```

> è¿™é‡Œæ¯æ¬¡è¿›è¡ŒåŒç±»çš„è®¡ç®—æ—¶ï¼ˆä¹˜æ³•å’ŒåŠ æ³•ä¸¤ç±»ï¼‰ï¼Œå…ˆåˆ¤æ–­ç¼“å­˜å¯¹è±¡cacheä¸­æ˜¯å¦å­˜åœ¨è¯¥å‚æ•°è¿æ¥æˆçš„å­—ç¬¦ä¸²ä½œä¸ºkeyçš„å±æ€§ã€‚
> å¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥ä»cacheä¸­è¯»å–ï¼Œå¦åˆ™å°±è¿›è¡Œè®¡ç®—å¹¶ä¿å­˜å…¶ç»“æœã€‚

```javascript
// è™šæ‹Ÿä»£ç†

const sleep = time => new Promise(resolve => setTimeout(resolve, time))

const imgFunc = (function() {
  let imgNode = document.createElement('img')
  document.body.appendChild(imgNode)

  return {
    setSrc(src) {
      imgNode.src = src
    }
  }
})()


const proxyImage = (function() {
  const img = new Image()
  img.onload = function() {
    imgFunc.setSrc(this.src)
  }

  return {
    setSrc(src) {
      imgFunc.setSrc('https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=766379944,3048822499&fm=26&gp=0.jpg')
      // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
      setTimeout(() => {
        img.src = src
      }, 2000)
    }
  }
})()

proxyImage.setSrc('http://t8.baidu.com/it/u=1484500186,1503043093&fm=79&app=86&f=JPEG?w=1280&h=853')
```

> å›¾ç‰‡æ‡’åŠ è½½çš„æ–¹å¼ï¼šå…ˆé€šè¿‡ä¸€å¼ loadingå›¾å ä½ï¼Œç„¶åé€šè¿‡å¼‚æ­¥çš„æ–¹å¼åŠ è½½å›¾ç‰‡ï¼Œç­‰å›¾ç‰‡åŠ è½½å¥½äº†å†æŠŠå®Œæˆçš„å›¾ç‰‡åŠ è½½åˆ°imgæ ‡ç­¾é‡Œé¢ã€‚

## ç­–ç•¥æ¨¡å¼

[https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F.html](https://fanerge.github.io/2017/jsè®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼.html)

>  å®šä¹‰ï¼šå®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚

```javascript
const strategy = {
  a(salary) {
     return salary * 4
  },
  b(salary) {
    return salary * 3
  },
  c(salary) {
    return salary * 2
  }
}


Object.freeze(strategy)


const returnMoney = (type, salary) => {
  return strategy[type](salary)
}

console.log(returnMoney('a', 1000))
console.log(returnMoney('b', 3000))
console.log(returnMoney('c', 4000))
```

ç®€å•çš„ä½¿ç”¨

ps: ç­–ç•¥æ¨¡å¼æŒ‡çš„æ˜¯å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå°†ä¸å˜çš„éƒ¨åˆ†å’Œå˜åŒ–çš„éƒ¨åˆ†éš”å¼€ï¼Œ
å®é™…å°±æ˜¯å°†ç®—æ³•çš„ä½¿ç”¨å’Œå®ç°åˆ†ç¦»å‡ºæ¥ï¼›

**è¡¨å•éªŒè¯**

æˆ‘åœ¨åŸæœ‰çš„codeä¸ŠåŠ äº†ä¸€ä¸ªæ–¹æ³•(é”™è¯¯å±•ç¤º, æ¯”è¾ƒåŸºç¡€æ‰€ä»¥å¾ˆå¤šåœ°æ–¹æ²¡æœ‰è€ƒè™‘åˆ°)

<iframe height="265" style="width: 100%;" scrolling="no" title="ç­–ç•¥æ¨¡å¼" src="https://codepen.io/xiaotiandada/embed/xxZOBvG?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/xiaotiandada/pen/xxZOBvG'>ç­–ç•¥æ¨¡å¼</a> by xiaotiandada
  (<a href='https://codepen.io/xiaotiandada'>@xiaotiandada</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>



```html
<!-- ... -->
<style>
  .error-msg {
    color: red;
    font-size: 14px;
  }
</style>

<form id="registerForm">
  <div>
    <label for="">ç”¨æˆ·å</label>
    <input type="text" name="username">
  </div>
  <div>
    <label for="">å¯†ç </label>
    <input type="password" name="password">
  </div>
  <div>
    <label for="">æ‰‹æœºå·ç </label>
    <input type="text" name="phoneNumber">
  </div>
  <button>submit</button>
</form>
<!-- ... -->
```

```js
// è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ç»„ç­–ç•¥ç±»å°è£…å…·ä½“çš„éªŒè¯è§„åˆ™
const strategyForm = {
	// æ˜¯å¦ä¸ºç©º
	isNotEmpty (value, errorMsg){
		if (value === '') {
			return errorMsg;
		}
	},
	// æœ€å°é•¿åº¦
	minLength (value, length, errorMsg){
		if (value.length < length) {
			return errorMsg;
		}
	},
	// æ‰‹æœºå·ç æ ¼å¼
	mobileFormat (value,errorMsg){
		if(!/(^1[3|5|8][0-9]{9}$)/.test(value)) {
			return errorMsg;
		}
	}
};
Object.freeze(strategyForm);


const Validator = function() {
  this.cache = []
}

Validator.prototype.add = function(dom, rules) {
	let slef = this
	// æ·»åŠ é”™è¯¯ä¿¡æ¯æç¤º
	const addErrorMsg = (msg, dom, errorMsg) => {
		// å¦‚æœæœ‰é”™è¯¯ä¿¡æ¯
		if (msg) {
			// å¦‚æœå·²ç»æœ‰äº†é”™è¯¯æç¤º
			let errorMsgDom = dom.parentNode.querySelector('.error-msg')
			if (errorMsgDom) {
				errorMsgDom.innerHTML = errorMsg
			} else {
				// æ²¡æœ‰æç¤ºåˆ›å»º
				let errorHtml = document.createElement('span')
				errorHtml.className = 'error-msg'
				errorHtml.innerHTML = errorMsg
				dom.parentNode.appendChild(errorHtml)
			}
		} else {
			// æ²¡æœ‰é”™è¯¯æç¤º
			// å¦‚æœæœ‰é”™è¯¯æç¤ºä½†æ˜¯tagè¿˜å­˜åœ¨åˆ™æ¸…é™¤
			let errorMsgDom = dom.parentNode.querySelector('.error-msg')
			if (errorMsgDom) {
				errorMsgDom.remove()
			}
		}
	}
	for(let i = 0, rule; rule = rules[i++]; ) {
		(function(rule) {
			let strategyArr = rule.strategy.split(':')
			let errorMsg = rule.errorMsg

			slef.cache.push(function() {
				let strategy = strategyArr.shift() // å–ç¬¬ä¸€ä¸ª ç­–ç•¥å
				strategyArr.unshift(dom.value)
				strategyArr.push(errorMsg)
				let msg = strategyForm[strategy].apply(dom, strategyArr)
				addErrorMsg(msg, dom, errorMsg)
				return msg
			})

		})(rule)
	}
}

Validator.prototype.start = function() {
	for (let i = 0, validatorFunc; validatorFunc = this.cache[i++];) {
		let msg = validatorFunc()
		if (msg) return msg
	}
}

let registerForm = document.getElementById('registerForm')

let validateFunc = function() {
	let validator = new Validator()
	validator.add(registerForm.username, [
		{ strategy: 'isNotEmpty', errorMsg: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º' },
		{ strategy: 'minLength:6', errorMsg: 'ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°äº6ä½' }
	])
	validator.add(registerForm.password,[
		{strategy: 'minLength:6',errorMsg:'å¯†ç é•¿åº¦ä¸èƒ½å°äº6ä½'},
	]);
	validator.add(registerForm.phoneNumber,[
		{strategy: 'mobileFormat',errorMsg:'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®'},
	]);
	let errorMsg = validator.start()
	return errorMsg
}

registerForm.onsubmit = function() {
	let errorMsg = validateFunc()
	if (errorMsg) {
		console.log(errorMsg)
	} else {
		console.log('done')
	}
	return false
}
```

## ä¸­ä»‹è€…æ¨¡å¼

https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F.html

å®šä¹‰ï¼šä¸­ä»‹è€…æ¨¡å¼çš„ä½œç”¨å°±æ˜¯è§£é™¤å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ç´§è€¦åˆå…³ç³»

```javascript
// MVC æ¨¡å¼
let M = {}
let V = {}
let C = {}

M.data = 'Hello World'
V.render = (M) => {
    // alert(M.data)
    document.body.append(document.createElement('p').innerHTML = M.data)
}
C.handleOnload = () => {
    V.render(M)
}


window.onload = C.handleOnload
```

<iframe height="265" style="width: 100%;" scrolling="no" title="ä¸­ä»‹è€…æ¨¡å¼" src="https://codepen.io/xiaotiandada/embed/abdBOvp?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/xiaotiandada/pen/abdBOvp'>ä¸­ä»‹è€…æ¨¡å¼</a> by xiaotiandada
  (<a href='https://codepen.io/xiaotiandada'>@xiaotiandada</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>

```html
<form action="#" id="selectPhone">
  <div>
    <label for="">é€‰æ‹©æ‰‹æœºé¢œè‰²</label>
    <select name="" id="colorSelect">
      <option value="">è¯·é€‰æ‹©</option>
      <option value="red">çº¢è‰²</option>
      <option value="blue">è“è‰²</option>
    </select>
  </div>
  <div>
    <label for="">é€‰æ‹©å†…å­˜</label>
    <select name="" id="memorySelect">
      <option value="">è¯·é€‰æ‹©</option>
      <option value="16G">16G</option>
      <option value="32G">32G</option>
    </select>
  </div>
  <div>
    <label for="">è¾“å…¥è´­ä¹°æ•°é‡</label>
    <input type="number" min="0" id="numberInput">
  </div>
  <div>
    æ‚¨é€‰æ‹©äº†é¢œè‰²: <div id="colorInfo"></div><br/>
    æ‚¨é€‰æ‹©äº†å†…å­˜: <div id="memoryInfo"></div><br/>
    æ‚¨è¾“å…¥äº†æ•°é‡: <div id="numberInfo"></div><br/>
    <button id="nextBtn" disabled="true">è¯·é€‰æ‹©æ‰‹æœºé¢œè‰²å’Œè´­ä¹°æ•°é‡</button>
  </div>
</form>
```

```javascript
let goods = {
   "red|32G": 3,
	"red|16G": 0,
	"blue|32G": 1,
	"blue|16G": 6
}

// è·å¾—æ‰€æœ‰èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œæ“ä½œï¼ˆä¸­ä»‹è€…å¿…è®¸è·å¾—å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼‰
let colorSelect = document.getElementById( 'colorSelect' )
let memorySelect = document.getElementById( 'memorySelect' )
let numberInput = document.getElementById( 'numberInput' )

let colorInfo = document.getElementById( 'colorInfo' )
let memoryInfo = document.getElementById( 'memoryInfo' )
let numberInfo = document.getElementById( 'numberInfo' )
let nextBtn = document.getElementById( 'nextBtn' )

let mediator = (function() {
    return {
        changed(obj) {
            var color = colorSelect.value // é¢œè‰²
            let memory = memorySelect.value// å†…å­˜
            let number = numberInput.value // æ•°é‡

            if (obj === colorSelect) {
                colorInfo.innerHTML = color
            } else if (obj === memorySelect) {
                memoryInfo.innerHTML = memory
            } else if (obj === numberInput) {
                numberInfo.innerHTML = number
            } else {
                console.log(obj)
            }

            if (!color) {
                nextBtn.disabled = true
                nextBtn.innerHTML = 'è¯·é€‰æ‹©æ‰‹æœºé¢œè‰²'
                return
            }

            if (!memory) {
                nextBtn.disabled = true
                nextBtn.innerHTML = 'è¯·é€‰æ‹©å†…å­˜å¤§å°'
                return
            }

            if (((number - 0) | 0 !== number - 0)) {
                nextBtn.disabled = true
                nextBtn.innerHTML = 'è¯·è¾“å…¥æ­£ç¡®çš„è´­ä¹°æ•°é‡'
                return
            }

            nextBtn.disabled = false;
			nextBtn.innerHTML = 'æ”¾å…¥è´­ç‰©è½¦';

        }
    }
})()


// ä¸ä¸­ä»‹è€…è”ç³»èµ·æ¥ï¼Œäº‹ä»¶å‡½æ•°
colorSelect.onchange = function(){
	mediator.changed( this );
};
memorySelect.onchange = function(){
	mediator.changed( this );
};
numberInput.onchange = function(){
	mediator.changed( this );
};
```

## å‘å¸ƒè®¢é˜…æ¨¡å¼

```js
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F.html

// å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚

const Event = (function() {
  // ç¼“å­˜åˆ—è¡¨
  let list = {}

  // ç›‘å¬å‡½æ•°
  const listen = function(key, fn) {
    if (!list[key]) {
      list[key] = []
    }
    list[key].push(fn)
  }

  // è§¦å‘ç›‘å¬
  const trigger = function() {
    let key = Array.prototype.shift.call(arguments)
    let fns = list[key]

    if (!fns || fns.length === 0) {
      return false
    }

    for (let i = 0, fn; fn = fns[i++];) {
      fn.apply(this, arguments)
    }
  }
  // ç§»é™¤ç›‘å¬å‡½æ•°
  const remove = function(key, fn) {
    let fns = list[key]

    if (!fns) {
      return false
    }

    if (!fn) {
      fns && (fns.length = 0)
    } else {
      for (let i = fns.length - 1; i >= 0; i--) {
        let _fn = fns[i]
        if (_fn === fn) {
          fns.splice(i, 1)
        }
      }
    }
  }

  return {
    listen,
    trigger,
    remove
  }
})()


function d1() {
  console.log('d11111')
}

function d2() {
  console.log('d22222')
}

function d3() {
  console.log('d33333')
}

Event.listen('color', d1)
Event.listen('color', d2)
Event.listen('color', d3)


Event.listen('size', d1)
Event.listen('size', d2)
Event.remove('size', d1)
Event.listen('size', d3)

Event.trigger('color')
console.log('----')
Event.trigger('size')
console.log('----')
Event.trigger('color')


// d11111
// d22222
// d33333
// ----
// d22222
// d33333
// ----
// d11111
// d22222
// d33333
```

## è¿­ä»£å™¨æ¨¡å¼

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F.html
// å®šä¹‰ï¼šè¿­ä»£å™¨æ¨¡å¼æ˜¯æŒ‡æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚

// å†…éƒ¨è¿­ä»£å™¨

const each = (array, callback) => {
  for (let i = 0, len = array.length; i < len; i++) {
    if (callback.call(array[i], array[i], i) === false) {
      break
    }
  }
}

each([1,2,3,4,5], (val, i) => {
  console.log(val + ' - ' + i)
})
console.log('-----')
each([1,2,3,4,5], (val, i) => {
  if (i === 3) {
    return false
  }
  console.log(val + ' - ' + i)
})

// å¤–éƒ¨è¿­ä»£å™¨

const Iterator = obj => {
  let current = 0;

  const next = () => {
    if (current > obj.length) {
      return false
    }
    current += 1;
  }

  const isDone = () => {
    return current >= obj.length
  }

  const getCurrentItem = () => {
    return obj[current]
  }

  return {
    next,
    isDone,
    getCurrentItem
  }
}

console.log('-----')

let iterator = Iterator([1,2,3,4,5])
console.log(iterator.getCurrentItem())
console.log(iterator.getCurrentItem())

iterator.next()

console.log(iterator.getCurrentItem())
console.log(iterator.isDone())

iterator.next()
console.log(iterator.getCurrentItem())
iterator.next()
console.log(iterator.getCurrentItem())
iterator.next()
console.log(iterator.getCurrentItem())
iterator.next()
console.log(iterator.getCurrentItem())
iterator.next()

console.log(iterator.isDone())



// 1 - 0
// 2 - 1
// 3 - 2
// 4 - 3
// 5 - 4
// -----
// 1 - 0
// 2 - 1
// 3 - 2
// -----
// 1
// 1
// 2
// false
// 3
// 4
// 5
// undefined
// true
```

## æ¡¥æ¥æ¨¡å¼

[https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F.html](https://fanerge.github.io/2017/jsè®¾è®¡æ¨¡å¼-æ¡¥æ¥æ¨¡å¼.html)

å®šä¹‰ï¼šæ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚



## å¤–è§‚æ¨¡å¼

```html
<button id="button">å¤–è§‚æ¨¡å¼</button>
<div id="foo"></div>
<div id="foo1"></div>
<div id="foo2"></div>
```

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F.html
// https://natee.gitbooks.io/javascript-design-patterns/facade-pattern.html
// å®šä¹‰ï¼šå¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›äº†ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œæ­¤æ¨¡å—å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚


const addEvent = function(el, ev, fn) {
  if (el.addEventListener) {
    el.addEventListener(ev, fn, false)
  } else if (el.attachEvent) {
    el.attachEvent(`on${ev}`, fn)
  } else {
    el[`on${ev}`] = fn
  }
}

// æ²¡æµ‹è¯•
let N = window.N || {}
N.tools = {
  stopPropagation(e) {
    if (e.stopPropagation) {
      e.stopPropagation()
    } else {
      e.cancelBubble = true
    }
  },
  preventDefault(e) {
    if (e.preventDefault) {
      e.preventDefault()
    } else {
      e.returnValue = false
    }
  },
  stopEvent(e) {
    this.stopPropagation(e)
    this.preventDefault(e)
  }
}


addEvent(document.getElementById('button'), 'click', function() {
  console.log('button')
})



function setStyles(elements, styles) {
  for (let i = 0, len = elements.length; i < len; i++) {
    let element = document.getElementById(elements[i])
    if (element) {
      for (let property in styles) {
        element.style[property] = styles[property]
      }
    }
  }
}

setStyles(['foo', 'foo1', 'foo2'], {
  backgroundColor: 'red',
  width: '150px',
  height: '200px'
});
```

## è®¿é—®è€…æ¨¡å¼

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F.html
// æ²¡å¤ªç†è§£...

function Visitor () {
  this.visit  = function(ConceteElement) {
    ConceteElement.doSomething()
  }
}

function ConceteElement() {
  this.doSomething = function() {
    console.log('this is a element')
  }

  this.accept = function(visitor) {
    visitor.visit(this)
  }
}


let visitor = new Visitor()
let conceteElement = new ConceteElement()

conceteElement.accept(visitor)

```

## æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼

å®šä¹‰ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼ç”±äºŒéƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ½è±¡çˆ¶ç±»ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å…·ä½“å®ç°çš„å­ç±»ï¼Œä¸€èˆ¬çš„æƒ…å†µä¸‹æ˜¯æŠ½è±¡çˆ¶ç±»å°è£…äº†å­ç±»çš„ç®—æ³•æ¡†æ¶ï¼ŒåŒ…æ‹¬å®ç°ä¸€äº›å…¬å…±æ–¹æ³•åŠå°è£…å­ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œå­ç±»å¯ä»¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%A8%A1%E7%89%88%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F.html


const ITInterview = function() {}

ITInterview.prototype.writeTest = function() {
  console.log('this is a write test')
}

ITInterview.prototype.technicalInterView = function() {
  console.log('this is a technical interview')
}

ITInterview.prototype.leader = function() {
  console.log('this is a leader interview')
}

ITInterview.prototype.waitNotice = function() {
  console.log('wait notice')
}

ITInterview.prototype.init = function() {
  this.writeTest()
  this.technicalInterView()
  this.leader()
  this.waitNotice()
}

const itInterview = new ITInterview()
itInterview.init()


// baidu
const BaiDuITInterview = function() {}
BaiDuITInterview.prototype = new ITInterview()

BaiDuITInterview.prototype.writeTest = function() {
  console.log('this is a baidu write test')
}

BaiDuITInterview.prototype.technicalInterView = function() {
  console.log('this is a baidu technical interview')
}


const baiduItInterview = new BaiDuITInterview()
baiduItInterview.init()

```

## ç»„åˆæ¨¡å¼

å®šä¹‰ï¼šç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F.html
// å®šä¹‰ï¼šç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚


// å®šä¹‰ç»„åˆå¯¹è±¡ï¼ˆæ–‡ä»¶å¤¹ï¼‰
let Folder = function(name) {
  this.name = name
  this.files = []
}

Folder.prototype.add = function(file) {
  this.files.push(file)
}

Folder.prototype.scan = function() {
  console.log('å¼€å§‹æ–‡ä»¶æ‰«æ:' + this.name)
	for( let i = 0, file, files = this.files; file = files[i++]; ){
		file.scan();
	}
} 

//å®šä¹‰å¶å­å¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰
let File = function(name) {
  this.name = name
}

File.prototype.add = function() {
  throw new Error('æ–‡ä»¶ä¸‹é¢ä¸èƒ½å†æ·»åŠ æ–‡ä»¶')
}
File.prototype.scan = function() {
  console.log('å¼€å§‹æ‰«ç„ï¼š' + this.name)
}


let folder = new Folder('å‰ç«¯å­¦ä¹ ');
let folder1 = new Folder('JSå­¦ä¹ ');
let folder2 = new Folder('JQå­¦ä¹ ');

let file1 = new File('JSè®¾è®¡æ¨¡å¼');
let file2 = new File('JQå®æˆ˜');
let file3 = new File('å‰ç«¯æ€§èƒ½');

folder1.add(file1);
folder2.add(file2);

folder.add(folder1);
folder.add(folder2);
folder.add(file3);
folder.scan();

// å¼€å§‹æ–‡ä»¶æ‰«æ:å‰ç«¯å­¦ä¹ 
// å¼€å§‹æ–‡ä»¶æ‰«æ:JSå­¦ä¹ 
// å¼€å§‹æ‰«ç„ï¼šJSè®¾è®¡æ¨¡å¼
// å¼€å§‹æ–‡ä»¶æ‰«æ:JQå­¦ä¹ 
// å¼€å§‹æ‰«ç„ï¼šJQå®æˆ˜
// å¼€å§‹æ‰«ç„ï¼šå‰ç«¯æ€§èƒ½
```

## å¤‡å¿˜å½•æ¨¡å¼

å®šä¹‰ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·å°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F.html
// å®šä¹‰ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·å°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€

const render = data => {
  console.log(data)
}

const page = function () {
  let cache = {}

  return (page) => {
    console.log('page', page)
    console.log('cache', JSON.stringify(cache))

    if (cache[page]) {
      render(cache[page])
    } else {
      let data = [
        {
          title: "hi"
        }
      ]

      cache[page] = data
      render(data)
    }
  }
}()



page(1)
page(1)
page(1)
page(1)

page(1)
page(2)
page(3)
page(4)

page(2)

```

## èŒè´£é“¾æ¨¡å¼

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F.html

// å®šä¹‰ï¼šèŒè´£é“¾æ¨¡å¼ï¼ˆChain of responsibilityï¼‰æ˜¯ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™ä¸ªå¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†ä»–ä¸ºæ­¢ã€‚èŒè´£é“¾æ¨¡å¼çš„åå­—éå¸¸å½¢è±¡ï¼Œä¸€ç³»åˆ—å¯èƒ½ä¼šå¤„ç†è¯·æ±‚çš„å¯¹è±¡è¢«è¯¥è¿æ¥æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨è¿™äº›å¯¹è±¡ä¹‹é—´ä¾æ¬¡ä¼ é€’ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªå¯ä»¥å¤„ç†å®ƒçš„å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™äº›å¯¹è±¡æˆä¸ºé“¾ä¸­çš„èŠ‚ç‚¹ã€‚

// 500 å…ƒå®¢æˆ·è®¢å•
var order500 = function (orderType, pay, stock) {
  if (orderType === 1 && pay) {
    console.log('500 rmb deposit, get 100 coupon ')
  } else {
    return 'nextSuccessor' // unknow the next node but always pass to next.
  }
};
// 200 å…ƒå®¢æˆ·è®¢å•
var order200 = function (orderType, pay, stock) {
  if (orderType === 2 && pay) {
    console.log('200 rmb deposit , get 50 coupon')
  } else {
    return 'nextSuccessor';
  }
};
// æ— é¢„çº¦å®¢æˆ·è®¢å•
var orderNormal = function (orderType, pay, stock) {
  if (stock > 0) {
    console.log('normal buy no coupon')
  } else {
    console.log('the stock lack')
  }
};

let Chain = function (fn) {
  this.fn = fn
  this.successor = null
}

Chain.prototype.setNextSuccessor = function (successor) {
  return this.successor = successor
}

Chain.prototype.passRequest = function () {
  let ret = this.fn.apply(this, arguments)
  if (ret === 'nextSuccessor') {
    return this.successor && this.successor.passRequest.apply(this.successor, arguments)
  }
  return ret
}



// ç°åœ¨æˆ‘ä»¬æŠŠ3ä¸ªè®¢å•å‡½æ•°åˆ†åˆ«åŒ…è£…æˆèŒè´£é“¾çš„èŠ‚ç‚¹
var chainOrder500 = new Chain(order500);
var chainOrder200 = new Chain(order200);
var chainOrderNormal = new Chain(orderNormal);

// è¿™é‡Œæˆ‘ä»¬æŠŠä¸Šé¢å°è£…çš„èŠ‚ç‚¹è¿æˆä¸€æ¡çº¿ï¼Œä¾æ¬¡åˆ¤æ–­æ‰§è¡Œ
chainOrder500.setNextSuccessor(chainOrder200)
chainOrder200.setNextSuccessor(chainOrderNormal)
// æµ‹è¯•ä»£ç 
chainOrder500.passRequest(1,true,6); // 500 rmb deposit, get 100 coupon
chainOrder500.passRequest(2,true,4); // 200 rmb deposit , get 50 coupon

chainOrderNormal.passRequest(2,true,0); // 200 rmb deposit , get 50 coupon

```

## çŠ¶æ€æ¨¡å¼

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F.html
// å®šä¹‰ï¼šçŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ç®¡ç†å…¶çŠ¶æ€ä»è€Œä½¿å¾—åº”ç”¨ç¨‹åºä½œå‡ºç›¸åº”çš„å˜åŒ–ã€‚

var trafficLight = (function () {
	var currentLight = null;
	return {
		change: function (light) {
			currentLight = light;
			currentLight.go();
		}
	}
})();


// çº¢ç¯
function RedLight() { }
RedLight.prototype.go = function () {
	console.log("this is red light");
}
// ç»¿ç¯
function GreenLight() { }
GreenLight.prototype.go = function () {
	console.log("this is green light");
}
// é»„ç¯
function YellowLight() { }
YellowLight.prototype.go = function () {
	console.log("this is yellow light");
}

trafficLight.change(new RedLight()); // this is red light
trafficLight.change(new YellowLight()); // this is yellow light


function Menu() { }
Menu.prototype.toggle = function (state) {
	state();
}

var menuStates = {
	"show": function () {
		console.log("the menu is showing");
	},
	"hide": function () {
		console.log("the menu is hiding");
	}
};

var menu = new Menu();
menu.toggle(menuStates.show);
menu.toggle(menuStates.hide);

```

## äº«å…ƒæ¨¡å¼

```javascript
// https://fanerge.github.io/2017/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F.html

// å®šä¹‰ï¼šäº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„æ¨¡å¼ï¼Œå¦‚æœç³»ç»Ÿä¸­å› ä¸ºåˆ›å»ºäº†å¤§é‡ç±»ä¼¼çš„å¯¹è±¡è€Œå¯¼è‡´å†…å­˜ä¸è¶³æˆ–å ç”¨è¿‡é«˜è¿™ç§æ¨¡å¼å°±éå¸¸æœ‰ç”¨äº†ã€‚

// å®šä¹‰å¡‘æ–™æ¨¡ç‰¹çš„æ„é€ å‡½æ•°
var Model = function (sex) {
	this.sex = sex;
}
// ä¸ºæ¨¡ç‰¹æ‹ç…§
Model.prototype.takePhoto = function () {
	console.log('sex=' + this.sex + 'underwear=' + this.underwear )
}
// å®ä¾‹åŒ–ä¸€ä¸ªç”·æ¨¡ç‰¹ å’Œ ä¸€ä¸ªå¥³æ¨¡ç‰¹
var maleModel = new Model('male');
let female    = new Model('female');    
for (var i = 1; i <=50; i++){
	// åˆ†åˆ«ä¸ºæ¨¡ç‰¹æ¢ä¸Š 50 ä»¶å†…è¡£ ä»¥åŠ ç…§ç›¸
	maleModel.underwear = 'underwear' + i;
	maleModel.takePhoto();
}
for (var i = 1; i <=50; i++){
	// åˆ†åˆ«ä¸ºæ¨¡ç‰¹æ¢ä¸Š 50 ä»¶å†…è¡£ ä»¥åŠ ç…§ç›¸
	female.underwear = 'underwear' + i;
	female.takePhoto();
}




let toolTipFactory = (function() {
  let tooplTipPool = []
  return {
    create: function() {
      if (tooplTipPool.length === 0) {
        console.log(1)
        let div = document.createElement('div')
        document.body.appendChild(div)
        return div
      } else {
        console.log(2)
        return tooplTipPool.shift()
      }
    },
    recover: function(tooltipDOm) {
      tooplTipPool.push(tooltipDOm)
    }
  }
})()

// 2
let arr = []
for (let i = 0, str; str = ['a', 'b'][i++];) {
  let toolTip = toolTipFactory.create()
  toolTip.innerHTML = str
  arr.push(toolTip)
}


for (let i = 0, toolTip; toolTip = arr[i++];) {
  toolTipFactory.recover(toolTip)
}

// 11
// 22
// 1111
for (let i = 0, str; str = ['a', 'b', 'c', 'd', 'e', 'f'][i++];) {
  let toolTip = toolTipFactory.create()
  toolTip.innerHTML = str
}
```

